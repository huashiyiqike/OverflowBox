{"version":3,"sources":["src/index.js"],"names":["isOverflow","el","curOverflow","style","overflow","isOverflowing","clientWidth","scrollWidth","clientHeight","scrollHeight","OverflowBox","props","state","check","low","high","str","handleWindowResize","bind","nextProps","setState","clearTimeout","timerResize","setTimeout","window","addEventListener","timerOverflow","slice","removeEventListener","mid","Math","floor","length","height","position","React","Component"],"mappings":"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","file":"index.js","sourcesContent":["import React from 'react'\n\nfunction isOverflow(el) {\n  const curOverflow = el.style.overflow\n  if (!curOverflow || curOverflow === 'visible') {\n    el.style.overflow = 'hidden'\n  }\n\n  const isOverflowing =\n    el.clientWidth < el.scrollWidth || el.clientHeight < el.scrollHeight\n\n  el.style.overflow = curOverflow\n  return isOverflowing\n}\n\n\nexport default class OverflowBox extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      check: true,\n      low: 0,\n      high: 500,\n      str: props.str\n    }\n    this.handleWindowResize = this.handleWindowResize.bind(this)\n  }\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.str !== this.props.str) {\n      this.setState({\n        check: true,\n        low: 0,\n        high: 500,\n        str: nextProps.str\n      })\n    }\n  }\n  handleWindowResize() {\n    clearTimeout(this.timerResize)\n    this.timerResize = setTimeout(() => {\n      this.setState({\n        check: true\n      })\n    }, 200)\n  }\n  componentDidMount() {\n    window.addEventListener('resize', this.handleWindowResize)\n    // delay for cases where this component is mounted but page css is not\n    this.timerOverflow = setTimeout(() => {\n      if (!isOverflow(this.el)) {\n        return this.setState({\n          check: false\n        })\n      }\n      this.setState({\n        str: this.props.str.slice(0, this.state.high)\n      })\n    }, 100)\n  }\n  componentWillUnmount() {\n    clearTimeout(this.timerOverflow)\n    clearTimeout(this.timerResize)\n    window.removeEventListener('resize', this.handleWindowResize)\n  }\n\n  componentDidUpdate() {\n    const { low, high, check } = this.state\n    if (!check) return\n    if (low + 1 < high) {\n      const mid = Math.floor((high + low) / 2)\n      this.setState(\n        {\n          str: this.props.str.slice(0, mid) + (mid === 0 ? '' : '...')\n        },\n        () => {\n          if (!this.state.check) return\n          if (!isOverflow(this.el)) {\n            this.setState({\n              low: mid\n            })\n          } else {\n            this.setState({\n              high: mid\n            })\n          }\n        }\n      )\n    } else {\n      setTimeout(() => {\n        const str = this.props.str.slice(0, Math.floor((high + low) / 2))\n        this.setState({\n          low: 0,\n          high: 500,\n          check: false,\n          str: low >= 499 ? str : str.length === 0 ? '' : str + '...'\n        })\n      })\n    }\n  }\n\n  render() {\n    const { str } = this.state\n    return (\n      <div\n        ref={(el) => {\n          this.el = el\n        }}\n        style={{ overflow: 'hidden', height: '100%', position: 'absolute' }}\n      >\n        {str}\n      </div>\n    )\n  }\n}\n"]}